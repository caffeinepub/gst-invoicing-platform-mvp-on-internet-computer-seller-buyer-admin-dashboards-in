{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "Extend the existing “Green Energy Usage Optimizer” app to ingest, process, store, and stream real-time energy readings (solar, appliances, battery, grid) to a React dashboard with low-latency, fault-tolerant updates via WebSockets or SSE, backed by a time-series database and JWT-secured connections.",
  "architectural_notes": [
    "Real-time transport will be WebSockets (ws://api/energy/live) or Server-Sent Events (GET /api/energy/stream), selected per backend capabilities.",
    "Backend validates and normalizes sensor/external API readings before storage and streaming to clients.",
    "Time-series capable datastore required (e.g., PostgreSQL + TimescaleDB or MongoDB time-series).",
    "JWT-based authentication required for real-time connections.",
    "Frontend uses React hooks/context and a dedicated realTimeService.js to manage connection lifecycle, auto-reconnect, and fallback to REST.",
    "Optional Redis layer can cache latest readings for low-latency UI updates."
  ],
  "known_issues": [],
  "isFixRequest": false,
  "existing_features": [
    {
      "id": "feature-frontend-create-a-dedicated-real-time-client-service-in-typescript-that-attempts-to-connect-to-a-live-stream-endpoint-websocket-ws-api-energy-live-or-sse-get-api-energy-stream-when-available-and-otherwise-falls-back-to-incremental-polling-against-the-backend-live-read-apis-the-service-must-manage-the-connection-lifecycle-auto-reconnect-with-backoff-throttling-of-ui-updates-and-error-recovery",
      "title": "Frontend: Create a dedicated real-time client service (in TypeScript) that attempts to connect to a live stream endpoint (WebSocket: ws://api/energy/live OR SSE: GET /api/energy/stream) when available, and otherwise falls back to incremental polling against the backend live-read APIs; the service must manage the connection lifecycle, auto-reconnect with backoff, throttling of UI updates, and error recovery.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-frontend-add-shared-live-telemetry-state-react-context-hooks-that-exposes-a-latest-readings-b-a-rolling-average-per-metric-over-a-short-window-c-connection-status-live-disconnected-and-d-data-freshness-timestamps-integrate-it-into-existing-authenticated-routes-pages",
      "title": "Frontend: Add shared live-telemetry state (React context + hooks) that exposes (a) latest readings, (b) a rolling average per metric over a short window, (c) connection status (LIVE/DISCONNECTED), and (d) data freshness timestamps; integrate it into existing authenticated routes/pages.",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-frontend-update-the-energy-consumption-module-consumption-solar-allocation-analysis-module-solar-analysis-and-cost-estimation-module-cost-estimation-to-display-live-updating-values-status-indicators-live-disconnected-and-clear-data-freshness-timestamps-with-smooth-transitions-for-value-changes-keep-existing-loading-error-empty-states-compatible",
      "title": "Frontend: Update the Energy Consumption module (/consumption), Solar Allocation & Analysis module (/solar-analysis), and Cost Estimation module (/cost-estimation) to display live-updating values, status indicators (LIVE/DISCONNECTED), and clear data-freshness timestamps, with smooth transitions for value changes; keep existing loading/error/empty states compatible.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-frontend-add-lightweight-logging-hooks-for-real-time-ingestion-streaming-health-connect-disconnect-events-retry-counts-last-message-time-and-error-reasons-and-ensure-logs-do-not-expose-jwts-or-sensitive-user-data",
      "title": "Frontend: Add lightweight logging hooks for real-time ingestion/streaming health (connect/disconnect events, retry counts, last message time, and error reasons) and ensure logs do not expose JWTs or sensitive user data.",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Implement backend real-time streaming endpoint (WebSocket or SSE) for live energy readings",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Backend pipeline to validate, normalize, and persist incoming sensor/API energy data to a time-series capable database",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "JWT authentication and authorization for real-time connections (WebSocket/SSE)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Reliability features for streaming: reconnection handling, throttling, error recovery, graceful degradation",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-5",
      "summary": "Frontend realTimeService.js (WebSocket/EventSource) with lifecycle management, auto-reconnect, and REST fallback",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "Update UI modules (Energy Consumption, Solar Allocation & Analysis, Cost Estimation) to render live charts, rolling averages, and LIVE/DISCONNECTED indicators",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-7",
      "summary": "Add optional Redis cache for latest readings to reduce latency and load",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-8",
      "summary": "Add logging/monitoring hooks for real-time ingestion and streaming health",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-9",
      "summary": "Backend: Add an authenticated ingestion API for incoming real-time energy readings from sensors/external energy APIs, including validation and normalization for these metrics: appliance power usage (Watts), solar generation (kW), battery charge level (%), and grid import/export.",
      "reqIds": [
        "REQ-1"
      ],
      "status": "pending"
    },
    {
      "id": "AR-10",
      "summary": "Backend: Persist and serve time-ordered energy readings in the single Motoko actor (backend/main.mo), providing query methods to fetch (a) the latest reading per metric and (b) incremental updates since a provided timestamp (or cursor) to support low-latency UI updates and fault-tolerant recovery after disconnects.",
      "reqIds": [
        "REQ-2"
      ],
      "status": "pending"
    },
    {
      "id": "AR-11",
      "summary": "Backend: Implement authorization checks suitable for real-time consumers, using the existing authenticated session model (frontend stores the token under localStorage key \"auth_token\") and ensuring only authenticated users can access live readings APIs.",
      "reqIds": [
        "REQ-3"
      ],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "Green Energy Usage Optimizer",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}